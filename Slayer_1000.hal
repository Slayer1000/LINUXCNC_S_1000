# Generated by PNCconf at Sun Mar  1 12:49:42 2020
# Using LinuxCNC version:  UNAVAILABLE
# Änderungen an dieser Datei werden beim nächsten
# overwritten when you run PNCconf again

loadrt [KINS]KINEMATICS
loadrt [EMCMOT]EMCMOT servo_period_nsec=[EMCMOT]SERVO_PERIOD num_joints=[KINS]JOINTS
loadrt hostmot2
loadrt hm2_eth board_ip="192.168.1.121" config=" num_encoders=7 num_pwmgens=0 num_stepgens=5 sserial_port_0=0030000" 
loadrt classicladder_rt
loadusr classicladder SPS.clp --nogui
addf classicladder.0.refresh servo-thread

loadusr -W /usr/share/ethercat/linuxcnc_ethercat/src/lcec_conf ethercat-conf.xml
loadrt lcec
addf lcec.read-all servo-thread

setp    hm2_7i76e.0.watchdog.timeout_ns 5000000
loadrt pid names=pid.b,pid.c,pid.s

addf hm2_7i76e.0.read          servo-thread
addf motion-command-handler   servo-thread
addf motion-controller        servo-thread
addf pid.b.do-pid-calcs       servo-thread
addf pid.s.do-pid-calcs       servo-thread
addf hm2_7i76e.0.write         servo-thread
setp hm2_7i76e.0.dpll.01.timer-us -50
setp hm2_7i76e.0.stepgen.timer-number 1

loadrt and2 count=6
addf and2.2 servo-thread
addf and2.3 servo-thread
addf and2.4 servo-thread
addf and2.5 servo-thread

# external output signals

#switchkins fehlende c achse
net c1 joint.4.motor-pos-fb joint.4.motor-pos-cmd
net w1 joint.5.motor-pos-fb joint.5.motor-pos-cmd

# net for control of motion.switchkins-type
net :kinstype-select <= motion.analog-out-03 => motion.switchkins-type

# compute pivot-length needed for 5axiskins
# according to gui pivot_len and tool z offset
loadrt sum2 names=pivotsum
addf pivotsum servo-thread

#Abstand B-Achse Drehpunkt
setp pivotsum.in0 103.757

net :tool-len <= motion.tooloffset.z
net :tool-len => pivotsum.in1

net :pivot-len <= pivotsum.out
net :pivot-len => 5axiskins.pivot-length

net :tool-diam <= halui.tool.diameter

# --- MACHINE-IS-ENABLED ---
loadrt timedelay count=4

addf timedelay.0 servo-thread
addf timedelay.1 servo-thread
addf timedelay.2 servo-thread
addf timedelay.3 servo-thread

setp timedelay.0.on-delay 1.5
setp timedelay.0.off-delay 0

setp timedelay.1.on-delay 2.5
setp timedelay.1.off-delay 0

net machine-is-enabled  => timedelay.0.in => timedelay.1.in 

#-----------------------------------------------------------
# X-Achse
#-----------------------------------------------------------
#net Signal Quelle Ziel Ziel ...



# STATEMACHINE X-Achse

net EnableAmpX joint.0.amp-enable-out 	=>	lcec.0.7.X-cmd-/QuickStop
net EnableAmpX					lcec.0.7.X-cmd-EnableVoltage
net X-StatusReadytoSwitchOn 	<=	lcec.0.7.X-stat-ReadyToSwitchOn 
net X-StatusReadytoSwitchOn   	lcec.0.7.X-cmd-SwitchOn
net X-StatusSwitchOn 			<=	lcec.0.7.X-stat-SwitchOn 
net X-StatusSwitchOn				lcec.0.7.X-cmd-EnableOperation
net X-StatusOperationEnable		<= 	lcec.0.7.X-stat-OperationEnable
net X-StatusOperationEnable		=>	lcec.0.7.X-cmd-EnableIPMode	# mÃ¼sste besser Enable IP Mode heiÃŸen
net X-Antriebsfehler	   lcec.0.7.X-stat-Fault => joint.0.amp-fault-in	#Fehlermeldung anzeigen
net X-Antriebsfehler			=>	lcec.0.7.X-cmd-FaultReset	#bei Neustart Fehler quittieren
net EnableAmpX joint.0.amp-enable-out 	=>	lcec.0.7.X-cmd-/QuickStop
net EnableAmpX					lcec.0.7.X-cmd-EnableVoltage

net Y-StatusReadytoSwitchOn 	<=	lcec.0.7.Y-stat-ReadyToSwitchOn 
net Y-StatusReadytoSwitchOn   	lcec.0.7.Y-cmd-SwitchOn
net Y-StatusSwitchOn 			<=	lcec.0.7.Y-stat-SwitchOn 
net Y-StatusSwitchOn				lcec.0.7.Y-cmd-EnableOperation
net Y-StatusOperationEnable		<= 	lcec.0.7.Y-stat-OperationEnable
net Y-StatusOperationEnable		=>	lcec.0.7.Y-cmd-EnableIPMode	# mÃ¼sste besser Enable IP Mode heiÃŸen
net Y-Antriebsfehler	   lcec.0.7.Y-stat-Fault => joint.1.amp-fault-in	#Fehlermeldung anzeigen
net Y-Antriebsfehler			=>	lcec.0.7.Y-cmd-FaultReset	#bei Neustart Fehler quittieren
net EnableAmpY joint.1.amp-enable-out 	=>	lcec.0.7.Y-cmd-/QuickStop
net EnableAmpY					lcec.0.7.Y-cmd-EnableVoltage

net Z-StatusReadytoSwitchOn 	<=	lcec.0.7.Z-stat-ReadyToSwitchOn 
net Z-StatusReadytoSwitchOn   	lcec.0.7.Z-cmd-SwitchOn
net Z-StatusSwitchOn 			<=	lcec.0.7.Z-stat-SwitchOn 
net Z-StatusSwitchOn				lcec.0.7.Z-cmd-EnableOperation
net Z-StatusOperationEnable		<= 	lcec.0.7.Z-stat-OperationEnable
net Z-StatusOperationEnable		=>	lcec.0.7.Z-cmd-EnableIPMode	# mÃ¼sste besser Enable IP Mode heiÃŸen
net Z-Antriebsfehler	   lcec.0.7.Z-stat-Fault => joint.2.amp-fault-in	#Fehlermeldung anzeigen
net Z-Antriebsfehler			=>	lcec.0.7.Z-cmd-FaultReset	#bei Neustart Fehler quittieren
net EnableAmpZ joint.2.amp-enable-out 	=>	lcec.0.7.Z-cmd-/QuickStop
net EnableAmpZ					lcec.0.7.Z-cmd-EnableVoltage

#Relais alte Bremse Z-Achse nicht in Betrieb
net machine-is-enabled  =>     hm2_7i76e.0.7i76.0.0.output-00

#Relais ethercat test
#net machine-is-enabled  =>     lcec.0.1.dout-0

#Relais für Zentralschmierung 230V
net machine-is-enabled  =>     hm2_7i76e.0.7i76.0.0.output-11

#Relais für Schütz des Spindelumrichters 230V
net machine-is-enabled  =>     hm2_7i76e.0.7i76.0.0.output-12

# external input signals
#net analog0 hm2_7i76e.0.7i77.0.2.analogin0

#net spindle-Leistung-1	 => spindel.leistung1
#net spindle-Leistung-2   => spindel.leistung2

net spindle-Leistung-2	 => hm2_7i76e.0.7i77.0.2.analogin0
setp hm2_7i76e.0.7i77.0.2.analogin0-scalemax 363

#net spindle-Leistung-2	 => talla.out_3

loadrt scale count=7

addf scale.1 servo-thread
setp scale.1.gain 0.183106

addf scale.2 servo-thread
setp scale.2.gain 0.183106

addf scale.3 servo-thread
setp scale.3.gain 0.183106

addf scale.4 servo-thread
setp scale.4.gain 5.46133

addf scale.5 servo-thread
setp scale.5.gain 5.46133

addf scale.6 servo-thread
setp scale.6.gain 5.46133

#*******************
#  AXIS X JOINT 0
#*******************

# ---setup home / limit switch signals---

net x-neg-limit     =>  joint.0.neg-lim-sw-in
net x-pos-limit     =>  joint.0.pos-lim-sw-in
#net x-homed => halui.joint.0.home <= lcec.0.7.X-Statuswort-Referenz_gefunden 



#*******************
#  AXIS Y JOINT 1
#*******************

net y-neg-limit     =>  joint.1.neg-lim-sw-in
net y-pos-limit     =>  joint.1.pos-lim-sw-in
#net y-homed => halui.joint.1.home <= lcec.0.7.Y-Statuswort-Referenz_gefunden

#*******************
#  AXIS Z JOINT 2
#*******************

net z-neg-limit     =>  joint.2.neg-lim-sw-in
net z-pos-limit     =>  joint.2.pos-lim-sw-in
#net z-homed => halui.joint.2.home <= lcec.0.7.Z-Statuswort-Referenz_gefunden


#-----------------------------------------------------------
# Istposition vom Motor an axis Übergeben
net Xachse_fb 	        lcec.0.7.X-Pos 		=> 	            scale.1.in
net Xachse_fb_scale 	scale.1.out         =>              joint.0.motor-pos-fb

net Yachse_fb 	        lcec.0.7.Y-Pos 		=> 	            scale.2.in
net Yachse_fb_scale 	scale.2.out         =>              joint.1.motor-pos-fb

net Zachse_fb 	        lcec.0.7.Z-Pos 		=> 	            scale.3.in
net Zachse_fb_scale 	scale.3.out         =>              joint.2.motor-pos-fb
#-----------------------------------------------------------

# Sollposition von axis an den Motor Übergeben
net Xachse_cmd 	        joint.0.motor-pos-cmd       =>       scale.4.in
net Xachse_cmd_scale 	scale.4.out                 =>       lcec.0.7.X-TargetPos

# Sollposition von axis an den Motor Übergeben
net Yachse_cmd 	        joint.1.motor-pos-cmd       =>       scale.5.in
net Yachse_cmd_scale 	scale.5.out                 =>       lcec.0.7.Y-TargetPos

# Sollposition von axis an den Motor Übergeben
net Zachse_cmd 	        joint.2.motor-pos-cmd       =>       scale.6.in
net Zachse_cmd_scale 	scale.6.out                 =>       lcec.0.7.Z-TargetPos
  
#-----------------------------------------------------------




#neue zeilen
#*******************
#  AXIS B JOINT 3
#*******************

setp   pid.b.Pgain     [JOINT_3]P
setp   pid.b.Igain     [JOINT_3]I
setp   pid.b.Dgain     [JOINT_3]D
setp   pid.b.bias      [JOINT_3]BIAS
setp   pid.b.FF0       [JOINT_3]FF0
setp   pid.b.FF1       [JOINT_3]FF1
setp   pid.b.FF2       [JOINT_3]FF2
setp   pid.b.deadband  [JOINT_3]DEADBAND
setp   pid.b.maxoutput [JOINT_3]MAX_OUTPUT
setp   pid.b.error-previous-target true

net b-index-enable  <=> pid.b.index-enable
net b-enable        =>  pid.b.enable
net b-pos-cmd       =>  pid.b.command
net b-pos-fb        =>  pid.b.feedback
net b-output        <=  pid.b.output

# ---PWM Generator signals/setup---

setp   hm2_7i76e.0.7i77.0.3.analogout0-scalemax  [JOINT_3]OUTPUT_SCALE
setp   hm2_7i76e.0.7i77.0.3.analogout0-minlim    [JOINT_3]OUTPUT_MIN_LIMIT
setp   hm2_7i76e.0.7i77.0.3.analogout0-maxlim    [JOINT_3]OUTPUT_MAX_LIMIT

net b-output     => hm2_7i76e.0.7i77.0.3.analogout0
net b-pos-cmd    <= joint.3.motor-pos-cmd
net b-enable     <= joint.3.amp-enable-out

# ---Encoder feedback signals/setup---

setp    hm2_7i76e.0.encoder.00.counter-mode 0
setp    hm2_7i76e.0.encoder.00.filter 1
setp    hm2_7i76e.0.encoder.00.index-invert 0
setp    hm2_7i76e.0.encoder.00.index-mask 0
setp    hm2_7i76e.0.encoder.00.index-mask-invert 0
setp    hm2_7i76e.0.encoder.00.scale  [JOINT_3]ENCODER_SCALE

net b-pos-fb               <=  hm2_7i76e.0.encoder.00.position
net b-vel-fb               <=  hm2_7i76e.0.encoder.00.velocity
net b-pos-fb               =>  joint.3.motor-pos-fb
net b-index-enable    joint.3.index-enable  <=>  hm2_7i76e.0.encoder.00.index-enable
net b-pos-rawcounts        <=  hm2_7i76e.0.encoder.00.rawcounts

#original
net A_Spur_A_Achse hm2_7i76e.0.encoder.00.input-a
net B_Spur_A_Achse  hm2_7i76e.0.encoder.00.input-b
net Z_Spur_A_Achse hm2_7i76e.0.encoder.00.input-index



# ---setup home / limit switch signals---

net home-b    =>  joint.3.home-sw-in
net b-neg-limit     =>  joint.3.neg-lim-sw-in
net b-pos-limit     =>  joint.3.pos-lim-sw-in


#*******************
#  AXIS C JOINT 4
#*******************

setp   pid.c.Pgain     [JOINT_4]P
setp   pid.c.Igain     [JOINT_4]I
setp   pid.c.Dgain     [JOINT_4]D
setp   pid.c.bias      [JOINT_4]BIAS
setp   pid.c.FF0       [JOINT_4]FF0
setp   pid.c.FF1       [JOINT_4]FF1
setp   pid.c.FF2       [JOINT_4]FF2
setp   pid.c.deadband  [JOINT_4]DEADBAND
setp   pid.c.maxoutput [JOINT_4]MAX_OUTPUT
setp   pid.c.error-previous-target true

net c-index-enable  =>  pid.c.index-enable
net c-enable        =>  pid.c.enable
net c-pos-cmd       =>  pid.c.command
net c-pos-fb        =>  pid.c.feedback
net c-output        <=  pid.c.output

# Schritt-Gen Signale/Setup

#setp   [HMOT](CARD0).stepgen.04.dirsetup        [JOINT_4]DIRSETUP
#setp   [HMOT](CARD0).stepgen.04.dirhold         [JOINT_4]DIRHOLD
#setp   [HMOT](CARD0).stepgen.04.steplen         [JOINT_4]STEPLEN
#setp   [HMOT](CARD0).stepgen.04.stepspace       [JOINT_4]STEPSPACE
#setp   [HMOT](CARD0).stepgen.04.position-scale  [JOINT_4]STEP_SCALE
#setp   [HMOT](CARD0).stepgen.04.step_type        0
# Position control mode (0) and velocity control mode (1).
#setp   [HMOT](CARD0).stepgen.04.control-type     0
#setp   [HMOT](CARD0).stepgen.04.maxaccel         [JOINT_4]STEPGEN_MAXACCEL
#setp   [HMOT](CARD0).stepgen.04.maxvel           [JOINT_4]STEPGEN_MAXVEL

# ---closedloop stepper signals velocity control mode---

#net c-pos-cmd    <= joint.4.motor-pos-cmd
#net c-vel-cmd    <= joint.4.vel-cmd
#net c-output     <= [HMOT](CARD0).stepgen.04.velocity-cmd
#net c-pos-fb     <= [HMOT](CARD0).encoder.04.position
#net c-pos-fb     => joint.4.motor-pos-fb

# ---openloop stepper signals position control mode ---

#net c-pos-cmd    <= joint.4.motor-pos-cmd
#net c-pos-cmd    => [HMOT](CARD0).stepgen.04.position-cmd
#net c-pos-fb     <= [HMOT](CARD0).stepgen.04.position-fb
#net c-pos-fb     => joint.4.motor-pos-fb

# ---enable stepgen---

net c-enable     <= joint.4.amp-enable-out
#net c-enable     => [HMOT](CARD0).stepgen.04.enable

# ---Einrichtung Referenzfahrt / Signale der Endschalter---

net c-home-sw       =>  joint.4.home-sw-in
net c-neg-limit     =>  joint.4.neg-lim-sw-in
net c-pos-limit     =>  joint.4.pos-lim-sw-in


#*******************
#  SPINDLE
#*******************
setp   pid.s.Pgain     [SPINDLE_0]P
setp   pid.s.Igain     [SPINDLE_0]I
setp   pid.s.Dgain     [SPINDLE_0]D
setp   pid.s.bias      [SPINDLE_0]BIAS
setp   pid.s.FF0       [SPINDLE_0]FF0
setp   pid.s.FF1       [SPINDLE_0]FF1
setp   pid.s.FF2       [SPINDLE_0]FF2
setp   pid.s.deadband  [SPINDLE_0]DEADBAND
setp   pid.s.maxoutput [SPINDLE_0]MAX_OUTPUT
setp   pid.s.error-previous-target true

#Encoderfunktion laden und mit dem Namen initiator deklarieren
loadrt encoder names=initiator
addf encoder.update-counters servo-thread
addf encoder.capture-position servo-thread

#Modus des Encoder (Initiator) festlegen 2 Impulse pro Umdrehung
setp initiator.counter-mode true
setp initiator.position-scale 2
setp initiator.x4-mode false



# Scalierungsfunktion laden für Spindelumdrehung Impulse pro Umdrehung - derzeit nicht richtig
addf scale.0 servo-thread
setp scale.0.gain 60


###############################################################
# ---setup spindle control signals---
# Spindel-Signale verbinden Signalname mit Funktions E/A'scale

net spindle-vel-cmd-rps          <=  spindle.0.speed-out-rps
net spindle-vel-cmd-rps-abs      <=  spindle.0.speed-out-rps-abs
net spindle-enable               <=  spindle.0.on
net spindle-cw                   <=  spindle.0.forward
net spindle-brake                <=  spindle.0.brake


#Übergabe position an Spindel planer
net spindle-position 		initiator.position 		=> spindle.0.revs
#net spindle-velocity 		initiator.velocity 		=> spindle.0.speed-in  
net spindle-index-enable 	initiator.index-enable <=> spindle.0.index-enable


#net PID_Fehler_X_Achse joint.0.f-error => spindel.x_pid_error
#net PID_Fehler_Y_Achse joint.1.f-error => spindel.y_pid_error
#net PID_Fehler_Z_Achse joint.2.f-error => spindel.z_pid_error


#Ausgang Index
#net spindle-index initiator.phase-Z <= servospindle.0.index


# Spindel Signale (Signalnamen) mit Hardware E/A's verbinden
net spindle-ccw    				<= hm2_7i76e.0.7i76.0.0.spindir <= spindle.0.reverse
net spindle-enable              <= hm2_7i76e.0.7i76.0.0.spinena

loadrt lincurve personality=6
addf lincurve.0 servo-thread
setp lincurve.0.x-val-00 0
setp lincurve.0.y-val-00 250
setp lincurve.0.x-val-01 300
setp lincurve.0.y-val-01 317
setp lincurve.0.x-val-02 500
setp lincurve.0.y-val-02 522
setp lincurve.0.x-val-03 1000
setp lincurve.0.y-val-03 1039
setp lincurve.0.x-val-04 3500
setp lincurve.0.y-val-04 3572
setp lincurve.0.x-val-05 7000
setp lincurve.0.y-val-05 7050

net spindle-raw spindle.0.speed-out-abs => lincurve.0.in
net spindle-corrected lincurve.0.out => hm2_7i76e.0.7i76.0.0.spinout

#spinout
#net Spindel-Sollwert            spindle.0.speed-out-abs	   => hm2_7i76e.0.7i76.0.0.spinout



setp hm2_7i76e.0.7i76.0.0.spinout-scalemax 7000
setp hm2_7i76e.0.7i76.0.0.spinout-minlim  -7000  
setp hm2_7i76e.0.7i76.0.0.spinout-maxlim 7000
setp hm2_7i76e.0.7i76.0.0.spindir-invert   false






#******************************
# connect miscellaneous signals
#******************************

#  ---HALUI signals---

#net axis-select-x  halui.axis.x.select
net jog-x-pos      halui.axis.x.plus
net jog-x-neg      halui.axis.x.minus
net jog-x-analog   halui.axis.x.analog
net x-is-homed     halui.joint.0.is-homed
#net axis-select-y  halui.axis.y.select
net jog-y-pos      halui.axis.y.plus
net jog-y-neg      halui.axis.y.minus
net jog-y-analog   halui.axis.y.analog
net y-is-homed     halui.joint.1.is-homed
#net axis-select-z  halui.axis.z.select
net jog-z-pos      halui.axis.z.plus
net jog-z-neg      halui.axis.z.minus
net jog-z-analog   halui.axis.z.analog
net z-is-homed     halui.joint.2.is-homed
#neue Zeilen
#net axis-select-a  halui.axis.a.select
net jog-a-pos      halui.axis.a.plus
net jog-a-neg      halui.axis.a.minus
net jog-a-analog   halui.axis.a.analog
net a-is-homed     halui.joint.3.is-homed
#ende neue Zeilen
net jog-selected-pos      halui.axis.selected.plus
net jog-selected-neg      halui.axis.selected.minus
net spindle-manual-cw     halui.spindle.0.forward
net spindle-manual-ccw    halui.spindle.0.reverse
net spindle-manual-stop   halui.spindle.0.stop
#net machine-is-on         halui.machine.is-on
net jog-speed             halui.axis.jog-speed
net MDI-mode              halui.mode.is-mdi


#  ---motion control signals---

net in-position               <=  motion.in-position
net machine-is-enabled        <=  motion.motion-enabled
#  ---digital in / out signals---


# Merken hm2_7i76e.0.7i76.0.0.output-06 --> Spindelkonus ausblasen
#	     hm2_7i76e.0.7i76.0.0.output-07 --> Sperrluft
#		 hm2_7i76e.0.7i76.0.0.output-05 --> Werkzeug auswerfen
#		 hm2_7i76e.0.7i76.0.0.input-31 --> Notaus
#		 hm2_7i76e.0.7i76.0.0.input-30 --> Werkzeug freigeben
#		 hm2_7i76e.0.7i76.0.0.input-13 --> Refrenztaste an der X Achse


# Power ON NO hm2_7i76e.0.7i77.0.2.input-20
# Power OFF NC hm2_7i76e.0.7i77.0.2.input-21
# RUN NO hm2_7i76e.0.7i77.0.2.input-24 #erl
# STOP NO hm2_7i76e.0.7i77.0.2.input-25
# WZG Wechsler NO hm2_7i76e.0.7i77.0.2.input-26 #erl
# NOTAUS NC hm2_7i76e.0.7i77.0.2.input-22
# NOTAUS NC hm2_7i76e.0.7i77.0.2.input-23



net external-mashine-on => halui.machine.on halui.joint.3.home
net external-mashine-off => halui.machine.off


net program-run-ok and2.2.in1 <= halui.mode.is-auto
net remote-program-run halui.program.run <= and2.2.out

net :xhomes-JAT   lcec.0.7.X-Statuswort-Referenz_gefunden   => and2.5.in1 
net homesetzenx =>   and2.5.out  halui.joint.0.home

net :yhomes-JAT   lcec.0.7.Y-Statuswort-Referenz_gefunden       => and2.4.in1
net homesetzeny =>   and2.4.out  halui.joint.1.home

net :zhomes-JAT   lcec.0.7.Z-Statuswort-Referenz_gefunden       => and2.3.in1 
net homesetzenz =>   and2.3.out  halui.joint.2.home halui.joint.4.home   halui.joint.5.home 



######################################################################################################################
######################################################################################################################
#### Ethercat Bereich  Start #########################################################################################
######################################################################################################################
######################################################################################################################

# Ethercat EK1100 im Schaltschrank an der Maschinen

######################################################################################################################
#EL2008_M1 Ausgänge:
#######################

#Sperrluft
net spindle-enable 	=> lcec.0.EL2008_M1.dout-0
net Spindel_Konusreinigung classicladder.0.out-00 => lcec.0.EL2008_M1.dout-1
net Spindel_WZGAuswerfer classicladder.0.out-01 => lcec.0.EL2008_M1.dout-2

#  ---coolant signals---
net Kuehlung_Kaltluft    <=  iocontrol.0.coolant-flood lcec.0.EL2008_M1.dout-3
net Kuehlung_MMS      <=  iocontrol.0.coolant-mist  lcec.0.EL2008_M1.dout-4

net machine-is-enabled => lcec.0.EL2008_M1.dout-5
net EL2008_M1_7_frei => lcec.0.EL2008_M1.dout-6
net EL2008_M1_8_frei => lcec.0.EL2008_M1.dout-7

######################################################################################################################
####EL2008_M2 Ausgänge:
#########################


#offen


######################################################################################################################
#### EL1008_M1 Eingänge:
########################
net Zentralschmierung_Druck <= lcec.0.EL1008_M1.din-0

#Eingang Initiatoren
net spindle-phase-a initiator.phase-A <= lcec.0.EL1008_M1.din-1-not
net spindle-phase-b initiator.phase-B
#net spindle-index initiator.phase-Z <= hm2_7i76e.0.7i76.0.0.input-15

#Umrechnen der waren Drehzahl
net Spindel_Drehzahl_Initiator_Wert_RAW_IST     <=     initiator.velocity      => scale.0.in 
net Spindel_Drehzahl_Umgerechnet_Scale_IST      <=     spindle.0.speed-in      <= scale.0.out

net Spindel_WZGAuswerfer_RM <= lcec.0.EL1008_M1.din-2-not
#net !!! Reserveeingang in Spindel !!! <= lcec.0.EL1008_M1.din-3

#net Spindelkühlung_an <=
net Druckluft_i_O_4Bar <= lcec.0.EL1008_M1.din-4
net Druckluft_i_O_6Bar <= lcec.0.EL1008_M1.din-5
net Kühlung_durchfluss_io <= lcec.0.EL1008_M1.din-6



######################################################################################################################
#### EL1008_M2 Eingänge:
########################


net external-mashine-on <= lcec.0.EL1008_M2.din-0
net external-mashine-off <= lcec.0.EL1008_M2.din-1-not
net program-start-btn halui.mode.auto and2.2.in0 <= lcec.0.EL1008_M2.din-2
net program-stop-bt halui.program.stop <= lcec.0.EL1008_M2.din-3
net Werkzeugwechseln-in classicladder.0.in-00 <= lcec.0.EL1008_M2.din-4


#  ---estop signals--- offen auf ethercat kabel an 7i77 nicht mehr angeschlossen
#net estop-out     <=  iocontrol.0.user-enable-out
net estop-out     <=  hm2_7i76e.0.7i77.0.2.input-22-not
#Zweiten Notauskreis noch verbinden
net estop-out     =>  iocontrol.0.emc-enable-in


######################################################################################################################
#### EP2318bZA bei Z Achse Eingänge:
####################################

# --- HOME-X ---
net home-x      <=  lcec.0.EP2318bZA.I1 =>  lcec.0.EL2008_S1.dout-3

# --- HOME-Y ---
net home-y      <=  lcec.0.EP2318bZA.I2 =>  lcec.0.EL2008_S1.dout-4

# --- HOME-Z ---
net home-z     <=  lcec.0.EP2318bZA.I3  =>  lcec.0.EL2008_S1.dout-5

# --- HOME-B ---
net home-b    <=  lcec.0.EP2318bZA.I4

#net !!!! Reserve bei Spindel ausen an Platte => lcec.0.EP2318bZA.A1

# Ethercat EK1100 im großen Schaltschrank 


######################################################################################################################
#### EL1008_M2 Eingänge:
########################

#Alarm Eingang Relais im Umrichter H220 Schaltet X93 X98 NC --> Alarm
net Alarm_H220_Ausgang => lcec.0.EL1008_S1.din-0

# FU Reilais Istfreq >= Sollfrequ
net spindle-at-speed spindle.0.at-speed  lcec.0.EL1008_S1.din-1


######################################################################################################################
#EL2008_S1 Ausgänge:
#######################

#Relais für Schütz der C-Achse 24V 200V
net machine-is-enabled  =>     lcec.0.EL2008_S1.dout-1

#Relais für Freigabe der C-Achse 24V // Brückung ENABLE Eingang X94 X91 //
net delay0_sig timedelay.0.out => lcec.0.EL2008_S2.dout-0 => and2.5.in0 => and2.4.in0 => and2.3.in0

#Relais für Bremse der C-Achse 24V
net delay1_sig timedelay.1.out => lcec.0.EL2008_S1.dout-0 => hm2_7i76e.0.7i77.0.3.analogena

#Relais für Alarm Reset // Brückung Alarm X91 X92 //
net Alarmreset_C => lcec.0.EL2008_S2.dout-1 lcec.0.EL1008_S3.din-4




######################################################################################################################
######################################################################################################################
#### Ethercat Bereich  Ende ##########################################################################################
######################################################################################################################
######################################################################################################################


#  ---manual tool change signals---

loadusr -W hal_manualtoolchange
net tool-change-request     iocontrol.0.tool-change       =>  hal_manualtoolchange.change
net tool-change-confirmed   iocontrol.0.tool-changed      <=  hal_manualtoolchange.changed
net tool-number             iocontrol.0.tool-prep-number  =>  hal_manualtoolchange.number
net tool-prepare-loopback   iocontrol.0.tool-prepare      =>  iocontrol.0.tool-prepared


# ---------- Load realtime components for [easy]probe ----------

loadrt  comp           names=comp_tool1,comp_tool2,comp_tool3
loadrt  dbounce        names=dbounce_probe
loadrt  lut5           names=lut_act_panel
loadrt  not            names=not_act_cal,not_disabled,not_tool1,not_tool2,not_tool3
loadrt  or2            names=or_act_cal,or_tool1,or_tool2,or_tool3,or_Kuehlung

addf    comp_tool1     servo-thread
addf    comp_tool2     servo-thread
addf    comp_tool3     servo-thread
addf    dbounce_probe  servo-thread
addf    lut_act_panel  servo-thread
addf    not_tool1      servo-thread
addf    not_tool2      servo-thread
addf    not_tool3      servo-thread
addf    not_act_cal    servo-thread
addf    not_disabled   servo-thread
addf    or_act_cal     servo-thread
addf    or_tool1       servo-thread
addf    or_tool2       servo-thread
addf    or_tool3       servo-thread

#Schütz Kühlanlage

addf or_Kuehlung servo-thread

net Oder_TEST_in1 or_Kuehlung.in0 lcec.0.EL1008_S3.din-7
net machine-is-enabled  => or_Kuehlung.in1
net Oder_TEST_out or_Kuehlung.out lcec.0.EL2008_S1.dout-2


#<---- letzter Eintrag sollte lcec write sein ---->
addf lcec.write-all servo-thread








